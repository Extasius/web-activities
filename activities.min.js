(function(){/*

 Copyright 2017 The Web Activities Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS-IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var d;function k(a,b,c,e,f,g){this.code=a;this.data="ok"==a?b:null;this.mode=c;this.origin=e;this.originVerified=f;this.secureChannel=g;this.ok="ok"==a;this.error="failed"==a?Error(String(b)||""):null};var l;function r(a){l||(l=document.createElement("a"));l.href=a;return l}function t(a){if(a.origin)return a.origin;var b=a.protocol,c=a.host;"https:"==b&&c.indexOf(":443")==c.length-4?c=c.replace(":443",""):"http:"==b&&c.indexOf(":80")==c.length-3&&(c=c.replace(":80",""));return b+"//"+c}function u(a){var b=a.indexOf("#");return-1==b?a:a.substring(0,b)}
function v(a){return a?(/^[?#]/.test(a)?a.slice(1):a).split("&").reduce(function(a,c){var b=c.split("=");c=decodeURIComponent(b[0]||"");var f=decodeURIComponent(b[1]||"");c&&(a[c]=f);return a},{}):{}}function x(a){var b={requestId:a.requestId,returnUrl:a.returnUrl,args:a.args};void 0!==a.origin&&(b.origin=a.origin);void 0!==a.originVerified&&(b.originVerified=a.originVerified);return JSON.stringify(b)}
function y(a,b,c){if(b.ok)c(b);else{var e;if(!(e=b.error)){e=null;if("function"==typeof a.DOMException){a=a.DOMException;try{e=new a("AbortError","AbortError")}catch(f){}}e||(e=Error("AbortError"),e.name="AbortError",e.code=20)}a=e;a.activityResult=b;c(Promise.reject(a))}}function A(a){var b=a.navigator;return/Trident|MSIE|IEMobile/i.test(b&&b.userAgent)}function B(a){a=a.navigator;return/Edge/i.test(a&&a.userAgent)}function C(a){setTimeout(function(){throw a;})};function D(a,b,c,e){this.a=a;this.X=b;this.c=c;this.ma=e;this.D=null;this.Y=!1;this.v=this.S=this.w=this.j=null;this.Z=this.ja.bind(this)}d=D.prototype;d.connect=function(a){if(this.w)throw Error("already connected");this.w=a;this.a.addEventListener("message",this.Z)};d.disconnect=function(){if(this.w&&(this.w=null,this.j&&(E(this.j),this.j=null),this.a.removeEventListener("message",this.Z),this.v)){for(var a in this.v){var b=this.v[a];b.port1&&E(b.port1);b.port2&&E(b.port2)}this.v=null}};
d.isConnected=function(){return null!=this.c};d.getTarget=function(){var a=F(this);if(!a)throw Error("not connected");return a};function F(a){a.w&&!a.D&&(a.D="function"==typeof a.X?a.X():a.X);return a.D}d.getTargetOrigin=function(){if(null==this.c)throw Error("not connected");return this.c};d.sendConnectCommand=function(){var a=A(this.a)||B(this.a);this.sendCommand("connect",{acceptsChannel:a})};
d.sendStartCommand=function(a){var b=null;this.Y&&"function"==typeof this.a.MessageChannel&&(b=new this.a.MessageChannel);b?(this.sendCommand("start",a,[b.port2]),H(this,b.port1)):this.sendCommand("start",a)};d.sendCommand=function(a,b,c){var e={sentinel:"__ACTIVITIES__",cmd:a,payload:b||null};if(this.j)this.j.postMessage(e,c||void 0);else{var f=this.getTarget(),g="connect"==a?null!=this.c?this.c:"*":this.getTargetOrigin();f.postMessage(e,g,c||void 0)}};
d.customMessage=function(a){this.sendCommand("msg",a)};d.onCustomMessage=function(a){this.S=a};d.startChannel=function(a){a=a||"";var b=I(this,a);if(!b.port1){var c=new this.a.MessageChannel;b.port1=c.port1;b.port2=c.port2;b.resolver(b.port1)}b.port2&&(this.sendCommand("cnset",{name:a},[b.port2]),b.port2=null);return b.promise};d.askChannel=function(a){a=a||"";var b=I(this,a);b.port1||this.sendCommand("cnget",{name:a});return b.promise};
function I(a,b){a.v||(a.v={});var c=a.v[b];if(!c){var e,f=new Promise(function(a){e=a}),c={port1:null,port2:null,resolver:e,promise:f};a.v[b]=c}return c}function H(a,b){a.j&&E(a.j);a.j=b;a.j.onmessage=function(b){var c=b.data,f=c&&c.cmd,c=c&&c.payload||null;f&&a.u(f,c,b)}}
d.ja=function(a){if(!this.ma||F(this)==a.source){var b=a.data;if(b&&"__ACTIVITIES__"==b.sentinel){var c=b.cmd;if(!this.j||"connect"==c||"start"==c){var e=a.origin,b=b.payload||null;null==this.c&&"start"==c&&(this.c=e);null==this.c&&a.source&&F(this)==a.source&&(this.c=e);e==this.c&&this.u(c,b,a)}}}};
d.u=function(a,b,c){"connect"==a?(this.j&&(E(this.j),this.j=null),this.Y=b&&b.acceptsChannel||!1,this.w(a,b)):"start"==a?((c=c.ports&&c.ports[0])&&H(this,c),this.w(a,b)):"msg"==a?null!=this.S&&null!=b&&this.S(b):"cnget"==a?this.startChannel(b.name):"cnset"==a?(a=c.ports[0],b=I(this,b.name),b.port1=a,b.resolver(a)):this.w(a,b)};function E(a){try{a.close()}catch(b){}};function J(a){var b=this;this.a=a;this.D=a.parent;this.b=new D(this.a,this.D,null,!1);this.h=null;this.f=!1;this.i=null;this.H=new Promise(function(a){b.i=a});this.g=!1;this.s=this.m=null;this.J=this.ba=0;this.$=this.na.bind(this)}d=J.prototype;d.connect=function(){this.g=this.f=!1;this.b.connect(this.u.bind(this));this.b.sendConnectCommand();return this.H};d.disconnect=function(){this.g=this.f=!1;this.b.disconnect();this.a.removeEventListener("resize",this.$)};
d.getRequestString=function(){K(this);return null};d.getMode=function(){return"iframe"};d.getTargetOrigin=function(){K(this);return this.b.getTargetOrigin()};d.isTargetOriginVerified=function(){K(this);return!0};d.isSecureChannel=function(){return!0};d.accept=function(){K(this);this.g=!0};d.getArgs=function(){K(this);return this.h};d.ready=function(){L(this);this.b.sendCommand("ready");this.F();this.a.addEventListener("resize",this.$)};d.setSizeContainer=function(a){this.s=a};
d.onResizeComplete=function(a){this.m=a};d.resized=function(){var a=this;setTimeout(function(){return a.F()},50)};d.isMessagingSupported=function(){return!0};d.message=function(a){L(this);this.b.customMessage(a)};d.onMessage=function(a){L(this);this.b.onCustomMessage(a)};d.messageChannel=function(a){L(this);return this.b.startChannel(a)};d.result=function(a){this.o("ok",a)};d.cancel=function(){this.o("canceled",null)};d.failed=function(a){this.o("failed",String(a))};
function K(a){if(!a.f)throw Error("not connected");}function L(a){if(!a.g)throw Error("not accepted");}d.o=function(a,b){"ok"==a?L(this):K(this);this.b.sendCommand("result",{code:a,data:b})};d.u=function(a,b){if("start"==a)this.h=b,this.f=!0,this.i(this),this.i=null;else if("close"==a)this.disconnect();else if("resized"==a){var c=b.height;this.m&&this.m(c,this.J,c<this.J)}};d.F=function(){if(this.s){var a=this.s.scrollHeight;a!=this.J&&(this.J=a,this.b.sendCommand("resize",{height:this.J}))}};
d.na=function(){var a=this.a.innerWidth;this.ba!=a&&(this.ba=a,this.resized())};function M(a){var b=this;if(!a.opener||a.opener==a)throw Error("No window.opener");this.a=a;this.D=a.opener;this.b=new D(this.a,this.D,null,!1);this.h=null;this.f=!1;this.i=null;this.H=new Promise(function(a){b.i=a});this.g=!1;this.s=this.m=null;this.U=new N(this.a);this.ea=null;this.R=this.oa.bind(this)}d=M.prototype;
d.connect=function(a){var b=this;this.g=this.f=!1;var c;return this.U.connect(a).then(function(){b.ea=b.U.getRequestString()},function(a){c=a}).then(function(){b.b.connect(b.u.bind(b));b.b.sendConnectCommand();setTimeout(function(){b.i&&(c?b.i(Promise.reject(c)):b.i(b.U),b.i=null)},5E3);return b.H})};d.disconnect=function(){this.g=this.f=!1;this.b.disconnect();this.a.removeEventListener("unload",this.R);try{this.a.close()}catch(a){}};d.getRequestString=function(){K(this);return this.ea};
d.getMode=function(){return"popup"};d.getTargetOrigin=function(){K(this);return this.b.getTargetOrigin()};d.isTargetOriginVerified=function(){K(this);return!0};d.isSecureChannel=function(){return!0};d.accept=function(){K(this);this.g=!0};d.getArgs=function(){K(this);return this.h};d.ready=function(){L(this);this.b.sendCommand("ready")};d.setSizeContainer=function(a){this.s=a};d.onResizeComplete=function(a){this.m=a};d.resized=function(){var a=this;setTimeout(function(){return a.F()},50)};
d.isMessagingSupported=function(){return!1};d.message=function(){L(this)};d.onMessage=function(){L(this)};d.messageChannel=function(){L(this);throw Error("not supported");};d.result=function(a){this.o("ok",a)};d.cancel=function(){this.o("canceled",null)};d.failed=function(a){this.o("failed",String(a))};d.ia=function(){if(!this.f)throw Error("not connected");};d.ha=function(){if(!this.g)throw Error("not accepted");};
d.o=function(a,b){"ok"==a?L(this):K(this);this.b.sendCommand("result",{code:a,data:b});this.a.removeEventListener("unload",this.R)};d.u=function(a,b){"start"==a?(this.h=b,this.f=!0,this.i(this),this.a.addEventListener("unload",this.R)):"close"==a&&this.disconnect()};d.F=function(){if(this.s){var a=this.s.scrollHeight,b=this.a.innerHeight;this.m&&this.m(b,a,b<a)}};d.oa=function(){this.b.sendCommand("check",{})};
function N(a){this.a=a;this.c=this.O=this.K=null;this.G=!1;this.h=null;this.g=this.f=!1;this.s=this.m=null}d=N.prototype;
d.connect=function(a){var b=this;return Promise.resolve().then(function(){b.f=!1;b.g=!1;var c;if(a&&"object"==typeof a)c=a;else{var e=!1,f;if(a&&"string"==typeof a)e=!0,f=a;else{var g=v(b.a.location.hash).__WA__;g&&(f=g)}if(f)if(c=e,c=void 0===c?!1:c,f){f=JSON.parse(f);var h={requestId:f.requestId,returnUrl:f.returnUrl,args:f.args||null};c&&(h.origin=f.origin||void 0,h.originVerified=f.originVerified||void 0);c=h}else c=null}if(!c||!c.requestId||!c.returnUrl)throw Error("Request must have requestId and returnUrl");
b.K=c.requestId;b.h=c.args;b.O=c.returnUrl;if(c.origin)b.c=c.origin,b.G=c.originVerified||!1;else{b.c=t(r(c.returnUrl));var q=b.a.document.referrer&&t(r(b.a.document.referrer));b.G=q==b.c}b.f=!0;return b})};d.disconnect=function(){this.g=this.f=!1};d.getRequestString=function(){K(this);return x({requestId:this.K,returnUrl:this.O,args:this.h,origin:this.c,originVerified:this.G})};d.getMode=function(){return"redirect"};d.getTargetOrigin=function(){K(this);return this.c};
d.isTargetOriginVerified=function(){K(this);return this.G};d.isSecureChannel=function(){return!1};d.accept=function(){K(this);this.g=!0};d.getArgs=function(){K(this);return this.h};d.ready=function(){L(this)};d.setSizeContainer=function(a){this.s=a};d.onResizeComplete=function(a){this.m=a};d.resized=function(){var a=this;setTimeout(function(){return a.F()},50)};d.isMessagingSupported=function(){return!1};d.message=function(){L(this)};d.onMessage=function(){L(this)};
d.messageChannel=function(){L(this);throw Error("not supported");};d.result=function(a){this.o("ok",a)};d.cancel=function(){this.o("canceled",null)};d.failed=function(a){this.o("failed",String(a))};d.ia=function(){if(!this.f)throw Error("not connected");};d.ha=function(){if(!this.g)throw Error("not accepted");};
d.o=function(a,b){"ok"==a?L(this):K(this);var c=this.K,e;e=this.a;e=e.origin||t(e.location);a={requestId:c,origin:e,code:a,data:b};var f=this.O+(-1==this.O.indexOf("#")?"#":"&")+"__WA_RES__="+encodeURIComponent(JSON.stringify(a));a=f;this.a.location.replace?this.a.location.replace(a):this.a.location.assign(a)};d.F=function(){if(this.s){var a=this.s.scrollHeight,b=this.a.innerHeight;this.m&&this.m(b,a,b<a)}};function O(a){this.version="1.21";this.a=a}O.prototype.connectHost=function(a){return(this.a.top!=this.a?new J(this.a):this.a.opener&&this.a.opener!=this.a&&!this.a.opener.closed?new M(this.a):new N(this.a)).connect(a)};function P(a,b,c){var e=this;this.I=a;this.P=b;this.h=c||null;this.a=this.I.ownerDocument.defaultView;this.c=t(r(b));this.f=!1;this.i=null;this.H=new Promise(function(a){e.i=a});this.L=null;this.ka=new Promise(function(a){e.L=a});this.l=null;this.N=new Promise(function(a){e.l=a});this.M=this.T=null;this.b=new D(this.a,function(){return e.I.contentWindow},this.c,!0)}d=P.prototype;d.getMode=function(){return"iframe"};
d.connect=function(){var a;a=this.I;if("isConnected"in a)a=a.isConnected;else{var b=a.ownerDocument&&a.ownerDocument.documentElement;a=b&&b.contains(a)||!1}if(!a)throw Error("iframe must be in DOM");this.b.connect(this.u.bind(this));this.I.src=this.P;return this.H};d.disconnect=function(){this.f=!1;this.b.disconnect()};d.acceptResult=function(){return this.N};d.message=function(a){this.b.customMessage(a)};d.onMessage=function(a){this.b.onCustomMessage(a)};d.messageChannel=function(a){return this.b.askChannel(a)};
d.whenReady=function(){return this.ka};d.onResizeRequest=function(a){var b=this;this.T=a;Promise.resolve().then(function(){null!=b.M&&a(b.M)})};d.resized=function(){this.f&&this.b.sendCommand("resized",{height:this.I.offsetHeight})};
d.u=function(a,b){"connect"==a?(this.f=!0,this.b.sendStartCommand(this.h),this.i()):"result"==a?this.l&&(a=b.code,b=new k(a,"failed"==a?Error(b.data||""):b.data,"iframe",this.b.getTargetOrigin(),!0,!0),y(this.a,b,this.l),this.l=null,this.b.sendCommand("close"),this.disconnect()):"ready"==a?this.L&&(this.L(),this.L=null):"resize"==a&&(this.M=b.height,this.T&&this.T(this.M))};function Q(a,b,c,e,f,g){var h=this,q=e&&("_blank"==e||"_top"==e||"_"!=e[0]);if(!q)throw Error('The only allowed targets are "_blank", "_top" and name targets');this.a=a;this.K=b;this.P=c;this.ca=e;this.h=f||null;this.C=g||{};this.l=null;this.N=new Promise(function(a){h.l=a});this.b=this.B=this.A=null}d=Q.prototype;d.getMode=function(){return"_top"==this.ca?"redirect":"popup"};d.open=function(){return R(this)};d.getTargetWin=function(){return this.A};
d.disconnect=function(){this.B&&(this.a.clearInterval(this.B),this.B=null);this.b&&(this.b.disconnect(),this.b=null);if(this.A){try{this.A.close()}catch(a){}this.A=null}this.l=null};d.acceptResult=function(){return this.N};
function R(a){var b=aa(a),c=a.P;if(!a.C.skipRequestInUrl)var e=a.C.returnUrl||u(a.a.location.href),e=x({requestId:a.K,returnUrl:e,args:a.h}),c=c+(-1==c.indexOf("#")?"#":"&")+encodeURIComponent("__WA__")+"="+encodeURIComponent(e);var f,g=a.ca;"_top"!=g&&A(a.a)&&(g="_top");try{f=a.a.open(c,g,b)}catch(h){}if(!f&&"_top"!=g&&!a.C.disableRedirectFallback){g="_top";try{f=a.a.open(c,g)}catch(h){}}f?(a.A=f,"_top"!=g&&ba(a)):S(a,Error("failed to open window"));return a.N.catch(function(){})}
function aa(a){var b=a.a.screen,c=b.availWidth||b.width,e=b.availHeight||b.height,f=a.a==a.a.top,g=B(a.a),h=f&&a.a.outerWidth>a.a.innerWidth?Math.min(100,a.a.outerWidth-a.a.innerWidth):g?100:0,q=f&&a.a.outerHeight>a.a.innerHeight?Math.min(100,a.a.outerHeight-a.a.innerHeight):g?100:0,m=Math.max(c-h,.5*c),z=Math.max(e-q,.5*e),n=Math.floor(Math.min(600,.9*m)),p=Math.floor(Math.min(600,.9*z));a.C.width&&(n=Math.min(a.C.width,m));a.C.height&&(p=Math.min(a.C.height,z));a=Math.floor((b.width-n)/2);b=Math.floor((b.height-
p)/2);n={height:p,width:n,resizable:"yes",scrollbars:"yes"};g||(n.left=a,n.top=b);var p="",w;for(w in n)p&&(p+=","),p+=w+"="+n[w];return p}function ba(a){a.B=a.a.setInterval(function(){T(a,!0)},500);a.b=new D(a.a,a.A,null,!0);a.b.connect(a.u.bind(a))}function T(a,b){if(!a.A||a.A.closed)a.B&&(a.a.clearInterval(a.B),a.B=null),a.a.setTimeout(function(){try{W(a,"canceled",null)}catch(c){S(a,c)}},b?3E3:0)}function S(a,b){a.l&&a.l(Promise.reject(b));a.disconnect()}
function W(a,b,c){if(a.l){var e=a.b.isConnected();b=new k(b,c,"popup",e?a.b.getTargetOrigin():t(r(a.P)),e,e);y(a.a,b,a.l);a.l=null}a.b&&a.b.sendCommand("close");a.disconnect()}d.u=function(a,b){var c=this;"connect"==a?this.b.sendStartCommand(this.h):"result"==a?(a=b.code,W(this,a,"failed"==a?Error(b.data||""):b.data)):"check"==a&&this.a.setTimeout(function(){return T(c)},200)};function X(a,b,c,e,f){this.a=a;this.fa=b;this.ga=c;this.c=e;this.G=f}X.prototype.getMode=function(){return"redirect"};
X.prototype.acceptResult=function(){var a=this,b=new k(this.fa,this.ga,"redirect",this.c,this.G,!1);return new Promise(function(c){y(a.a,b,c)})};function Y(a){var b=this;this.version="1.21";this.a=a;this.aa=a.location.hash;this.V={};this.W={};this.da=null;this.la=new Promise(function(a){b.da=a})}Y.prototype.openIframe=function(a,b,c){var e=new P(a,b,c);return e.connect().then(function(){return e})};Y.prototype.open=function(a,b,c,e,f){var g=this,h=new Q(this.a,a,b,c,e,f);h.open().then(function(){ca(g,a,h)});return{targetWin:h.getTargetWin()}};
Y.prototype.onResult=function(a,b){var c=this.V[a];c||(c=[],this.V[a]=c);c.push(b);var e=this.W[a];if(!e&&this.aa){try{var f=this.a,g=v(this.aa).__WA_RES__;if(g){var h=JSON.parse(g);if(h&&h.requestId==a){var q;var m=f.location.hash;if(m){var z=encodeURIComponent("__WA_RES__")+"=",g=-1;do if(g=m.indexOf(z,g),-1!=g){var n=0<g?m.substring(g-1,g):"";if(""==n||"?"==n||"#"==n||"&"==n){var p=m.indexOf("&",g+1);-1==p&&(p=m.length);m=m.substring(0,g)+m.substring(p+1)}else g++}while(-1!=g&&g<m.length)}q=m;
q=q||"";if(q!=f.location.hash&&f.history&&f.history.replaceState)try{f.history.replaceState(f.history.state,"",q)}catch(G){}var w=h.code,da=h.data,U=h.origin,ea=f.document.referrer&&t(r(f.document.referrer)),e=new X(f,w,da,U,U==ea)}else e=null}else e=null}catch(G){C(G),this.da(G)}e&&(this.W[a]=e)}var V=e;V&&Z(V,b)};Y.prototype.onRedirectError=function(a){this.la.then(a)};function Z(a,b){Promise.resolve().then(function(){b(a)})}
function ca(a,b,c){var e=a.V[b];e&&e.forEach(function(a){Z(c,a)});a.W[b]=c};(function(a){function b(a){Promise.resolve().then(function(){a(f)})}var c=new Y(a),e=new O(a),f={};Object.defineProperty(f,"version",{value:"1.21",configurable:!1});Object.defineProperty(f,"ports",{get:function(){return c}});Object.defineProperty(f,"hosts",{get:function(){return e}});var g=a.ACTIVITIES,h={};Object.defineProperty(h,"push",{get:function(){return b},configurable:!1});a.ACTIVITIES=h;g&&g.forEach(b)})(self);})();
//# sourceMappingURL=activities.min.js.map

